<div class="container mt-4">
	<h2 class="mb-4">{{ storeId ? 'Редактирование торговой точки' : 'Создание торговой точки' }}</h2>

	<!-- Сообщение об ошибке -->
	<div *ngIf="errorMessage" class="alert alert-danger" role="alert">
		{{ errorMessage }}
	</div>

	<!-- Форма редактирования -->
	<form [formGroup]="storeForm" (ngSubmit)="updateStore()" class="border p-4 bg-light rounded">
		<div class="row g-3">
			<div class="col-md-3">
				<label for="building" class="form-label">Здание:</label>
				<div class="input-group">
					<input id="building" formControlName="building" type="text" class="form-control" readonly />
					<button type="button" class="btn btn-outline-secondary" (click)="openModal('building', 'select')">
						Выбрать
					</button>
					<button type="button" class="btn btn-outline-primary" (click)="openModal('building', 'add')">
						Добавить
					</button>
				</div>
			</div>

			<div class="col-md-3">
				<label for="floor" class="form-label">Этаж:</label>
				<div class="input-group">
					<input id="floor" formControlName="floor" type="text" class="form-control" readonly />
					<button type="button" class="btn btn-outline-secondary" (click)="openModal('floor', 'select')">
						Выбрать
					</button>
					<button type="button" class="btn btn-outline-primary" (click)="openModal('floor', 'add')">
						Добавить
					</button>
				</div>
			</div>

			<div class="col-md-3">
				<label for="line" class="form-label">Линия:</label>
				<div class="input-group">
					<input id="line" formControlName="line" type="text" class="form-control" readonly />
					<button type="button" class="btn btn-outline-secondary" (click)="openModal('line', 'select')">
						Выбрать
					</button>
					<button type="button" class="btn btn-outline-primary" (click)="openModal('line', 'add')">
						Добавить
					</button>
				</div>
			</div>

			<div class="col-md-3">
				<label for="storeNumber" class="form-label">Торговая точка:</label>
				<div class="input-group">
					<input id="storeNumber" formControlName="storeNumber" type="text" class="form-control" readonly />
					<button type="button" class="btn btn-outline-secondary"
						(click)="openModal('storeNumber', 'select')">
						Выбрать
					</button>
					<button type="button" class="btn btn-outline-primary" (click)="openModal('storeNumber', 'add')">
						Добавить
					</button>
				</div>
			</div>
		</div>

		<div class="row g-3 mt-3">
			<div class="col-md-6">
				<label for="sortOrder" class="form-label">Порядок сортировки:</label>
				<input id="sortOrder" formControlName="sortOrder" type="number" class="form-control"
					[class.is-invalid]="storeForm.get('sortOrder')?.invalid && storeForm.get('sortOrder')?.touched" />
				<div *ngIf="storeForm.get('sortOrder')?.hasError('min')" class="invalid-feedback">
					Порядок сортировки должен быть больше или равен 0.
				</div>
			</div>

			<div class="col-md-6">
				<label for="note" class="form-label">Заметка:</label>
				<textarea id="note" formControlName="note" class="form-control" rows="4"
					[class.is-invalid]="storeForm.get('note')?.invalid && storeForm.get('note')?.touched"></textarea>
				<div *ngIf="storeForm.get('note')?.hasError('maxlength')" class="invalid-feedback">
					Заметка не должна превышать 500 символов.
				</div>
			</div>
		</div>

		<div class="row mt-4">
			<div class="col-md-12 text-end">
				<button type="submit" class="btn btn-primary btn-equal" [disabled]="storeForm.invalid || !isModified()">
					Сохранить
				</button>
				<button type="button" class="btn btn-secondary btn-equal" (click)="navigateBack()">
					Отмена
				</button>
				<button *ngIf="!storeForm.get('isArchived')?.value" type="button" class="btn btn-danger btn-equal"
					(click)="archiveStore()">
					Архивировать
				</button>
				<button *ngIf="storeForm.get('isArchived')?.value" type="button" class="btn btn-success btn-equal"
					(click)="unarchiveStore()">
					Разархивировать
				</button>
			</div>
		</div>
	</form>

	<app-store-select-or-add-modal *ngIf="isModalOpen" [fieldName]="modalField" [mode]="modalMode"
		(modalClose)="closeModal()" (itemSelected)="selectItem($event)"
		(itemAdded)="addItem($event)"></app-store-select-or-add-modal>
</div>